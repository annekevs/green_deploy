{"version":3,"sources":["components/Machine/CRUD/Edit.js"],"names":["EditMachine","props","swalCallback","history","push","toggleStep","activeStep","form","formMachineRef","tabPane","document","getElementById","state","inputs","slice","call","querySelectorAll","FormValidator","bulkValidate","errors","hasError","setState","name","progressValue","console","log","getModele","axios","get","url_modeles","then","res","modeles","data","isLoading","catch","error","getMachine","id","url_machines","machine","selectedModele","modele","libelle","nom","zone","createdAt","level","status","localite","coordonnees","Object","pays","rue","ville","quartier","latitude","longitude","formMachine","key","path","label","value","swal","editMachine","id_modele","put","docRef","validateOnChange","event","input","target","type","checked","result","validate","find","formName","inputName","method","handleSubmit","e","elements","filter","i","includes","nodeName","preventDefault","isFinish","formRef","node","unsubscribe","isUpdated","swalSuccess","title","text","icon","swalError","this","match","params","Component"],"mappings":"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","file":"static/js/49.35f791b6.chunk.js","sourcesContent":["/**editer les informations d'une machine */\nimport React, { Component } from 'react';\nimport axios from 'axios';\nimport {url_machines, url_modeles} from '../../../urls'\nimport ContentWrapper from '../Layout/ContentWrapper';\nimport FormValidator from '../../Common/FormValidator';\nimport Machine from './AddUpMachine';\nimport HeadingMenu from '../HeadingMenu';\nimport swal from 'sweetalert';\n\nclass EditMachine extends Component {\n    constructor(props) {\n        super(props);        \n        //this.refModele = firebase.firestore().collection('modeles');\n        this.unsubscribe = null;\n        this.state = {\n            formMachine : {\n                nom: '',\n                zone: '',\n                level: '',\n                status: '',\n                pays: '',\n                ville:'',\n                quartier:'',\n                rue:'',\n                libelle:'',\n                latitude: '',\n                longitude: '',\n                key: ''\n            },\n            createdAt: '',\n            modeles: [],\n            isLoading: true,\n            isUpdated: false,\n            isFinish : false,\n            selectedModele: {},\n            activeStep: '1',\n            progressValue: [100, 0, 0],\n            path: [\n                { \n                    label: 'Home',\n                    value: '/dashboard_machine',\n                },\n                { \n                    label: 'Machine',\n                    value: '/list_machine',\n                },\n                { \n                    label: 'Editer',\n                    value: '',\n                }\n            ],\n\n            swalSuccess: {\n                title: \"Good Job\",\n                text: \"Les modifications apportées à la machine ont été prise en compte !\",\n                icon: \"success\"\n            },\n            swalError: {\n                title: \"Désolé...\",\n                text: \"Les modifications n'ont pas été effectuées\",\n                icon: \"danger\"\n            }\n        };\n    }\n\n    swalCallback = () => {\n        this.props.history.push(\"/list_machine/\")\n    }\n\n    toggleStep = activeStep => () => {\n        // For submit we can obtain the form from the event\n        // but for each step we need a global ref to the element\n        const form = this.formMachineRef;\n        // To validate only the inputs in the current steps, we use an id to query the tabPane\n        // and then find all form elements for the current step only.\n        const tabPane = document.getElementById('tabPane' + this.state.activeStep);\n        const inputs = [].slice.call(tabPane.querySelectorAll('input,select'));\n        // Run validation of inputs\n        const { errors, hasError } = FormValidator.bulkValidate(inputs);\n\n        // Update state so the validation message are shown/hidden\n        this.setState({\n            [form.name]: {\n                ...this.state[form.name],\n                errors\n            }\n        });\n\n        // and prevent change the if form is not valid\n        if (!hasError) {\n            const progessValue1 = [100, 0, 0];\n            const progessValue2 = [0, 100, 0];\n            const progessValue3 = [0, 0, 100];\n        \n            if (this.state.activeStep !== activeStep) {\n                this.setState({\n                    activeStep\n                });\n            }\n            switch (activeStep) {\n                case '1':\n                    this.setState({\n                        progressValue: progessValue1\n                    });\n                    break;\n                case '2':\n                    this.setState({\n                        progressValue: progessValue2\n                    });\n                    break;\n                case '3':\n                    this.setState({\n                        progressValue: progessValue3\n                    });\n                    break;\n                default:\n                    console.log('default')\n            }\n        }\n    }\n\n    /* obtenir la liste de tous les modeles\n    onCollectionUpdate = (querySnapshot) => {\n        const modeles = [];\n        querySnapshot.forEach((docModele) => {\n          const {libelle, description, capacite, dimension} = docModele.data();\n          const {longueur, largeur, hauteur} = new Object(dimension);\n  \n          /* remplir la liste des modèles *\n          modeles.push({\n            keyModele: docModele.id,\n            libelle: libelle,\n            description: description,\n            capacite: capacite,\n            longueur: longueur,\n            hauteur: hauteur,\n            largeur: largeur,\n          });\n        });\n        this.setState({\n          modeles : modeles,\n          isLoading: false\n       });\n    } */\n\n    getModele = () => {\n        axios.get(url_modeles)\n        .then(res => {\n            const modeles = res.data.data.modeles\n            console.log(modeles)\n            this.setState({\n                modeles : modeles,\n                isLoading: false\n            })\n            console.log(this.state.modeles);\n        })\n        .catch((error) => {\n            console.log(\"get modele failed!\")\n            console.log(error)\n        })\n    }\n\n    getMachine = (id) => {\n        axios.get(`${url_machines}${id}`)\n        .then((res) => {\n            const machine = res.data.data.machine\n            const selectedModele = machine.modele\n            const libelle = selectedModele.libelle;\n            const { nom, zone, createdAt, level, status, localite, coordonnees } = machine;\n            const {pays, rue, ville, quartier} = new Object(localite)\n            const {latitude, longitude} = new Object(coordonnees)\n            //test recupération des coordonnées\n            console.log(latitude)\n            \n            console.log(res)\n            this.setState({\n                formMachine : {\n                    nom: nom,\n                    zone: zone,\n                    level : level,\n                    status : status,\n                    pays: pays,\n                    ville: ville,\n                    quartier: quartier,\n                    rue: rue,\n                    libelle: libelle,\n                    latitude: latitude,\n                    longitude: longitude,\n                    key: machine.key,\n                },\n                selectedModele : selectedModele,\n                createdAt: createdAt,\n            })\n            //heading nav\n            this.state.path.push({\n                label: nom,\n                value:''            \n            })\n        })\n        .catch((error) => {\n            console.log(\"No such machine!\", error);\n            swal(\"Erreur\", `Cher GreenManager, veillez selectionner une GreenBox pour obtenir ses informations ${error}`, \"warning\").then((value) => {\n                this.props.history.push(\"/dashboard_machine/\")\n            })\n        })\n    }\n\n    editMachine = () => {\n        const {key, nom, zone, pays, rue, ville, quartier, latitude, longitude } = this.state.formMachine;\n        const id_modele =this.state.selectedModele.key\n        console.log(id_modele)\n        const localite = {pays, rue, ville, quartier}\n        const coordonnees = {latitude, longitude}\n        \n        console.log(this.state.formMachine);\n        \n        axios.put(`${url_machines}${key}`, {\n            nom,\n            zone, \n            localite,\n            id_modele,\n            coordonnees, \n        })\n        .then((docRef) => {\n            this.setState({\n              formMachine : {            \n                nom: '',\n                zone: '',\n                pays: '',\n                ville:'',\n                quartier:'',\n                rue:'',\n                libelle: '',\n                latitude: '',\n                longitude: '',\n                key: '',\n              },\n              selectedModele : {},\n            });\n            //feedback\n            console.log(\"Une GreenBox modifiée!\");\n            swal(\"Super!\", \"Les modifications de la GreenBox ont bien été prise en compte\", \"success\").then((value) => {\n                this.props.history.push(\"/list_machine/\")\n            })\n        }).catch((error) => {\n          console.error(\"Error editing document: \", error);\n          swal(\"Desolée!\", \"Les informations de cette GreenBox n'ont pas pu être modifiée, veuillez vérifier vos paramètres de connexion\", \"success\")\n        });\n    }\n\n    componentDidMount() {\n        const id = this.props.match.params.id\n        console.log(id);\n\n        // get modeles \n        this.getModele();\n        // get machine\n        this.getMachine(id);\n    }\n\n    /**\n      * Validate input using onChange event\n      * @param  {String} formName The name of the form in the state object\n      * @return {Function} a function used for the event\n    */\n    validateOnChange = event => {\n        const input = event.target;\n        const form = input.form;\n        const value = input.type === 'checkbox' ? input.checked : input.value;\n\n        const result = FormValidator.validate(input);\n\n        this.setState({\n            [form.name]: {\n                ...this.state[form.name],\n                [input.name]: value,\n                errors: {\n                    ...this.state[form.name].errors,\n                    [input.name]: result\n                }\n            }\n        });\n\n        if (input.name == 'libelle') {\n            // update les informations sur le modele\n            const selectedModele = this.state.modeles.find(modele => modele.libelle == value)\n            console.log(selectedModele)       \n            this.setState({\n                selectedModele : selectedModele\n            })\n        }\n    };\n\n    /* Simplify error check */\n    hasError = (formName, inputName, method) => {\n        return  this.state[formName] &&\n                this.state[formName].errors &&\n                this.state[formName].errors[inputName] &&\n                this.state[formName].errors[inputName][method]\n    }    \n\n    handleSubmit = e => {\n        const form = e.target;\n        const inputs = [...form.elements].filter(i => ['INPUT', 'SELECT'].includes(i.nodeName))\n\n        const { errors, hasError } = FormValidator.bulkValidate(inputs)\n\n        this.setState({\n            [form.name]: {\n                ...this.state[form.name],\n                errors\n            }\n        });\n\n        console.log(hasError ? 'Form has errors. Check!' : 'Form Submitted!')\n        e.preventDefault();\n\n        this.editMachine();\n        \n        this.setState({\n            isFinish : true\n        })\n    }\n    \n    // Keep a reference to the form to access from the steps methods\n    formRef = node => (this.formMachineRef = node);\n\n    render() {\n        console.log(this.state.formMachine)\n        return (            \n            <ContentWrapper>\n                    <HeadingMenu path = {this.state.path}/>\n\n                    <Machine \n                    machine={this.state}\n                    formRef={this.formRef}\n                    toggleStep={this.toggleStep}\n                    validateOnChange = {this.validateOnChange}\n                    hasError={this.hasError}\n                    handleSubmit = {this.handleSubmit}\n                    swalCallback = {this.swalCallback}\n                    />\n            </ContentWrapper>\n            );\n    }\n\n}\n\nexport default EditMachine;\n"],"sourceRoot":""}